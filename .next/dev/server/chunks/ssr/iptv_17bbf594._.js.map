{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Home/Downloads/iptv/app/actions/auth-actions.ts"],"sourcesContent":["'use server'\r\n\r\nimport { createClient } from '@supabase/supabase-js'\r\n\r\nexport async function registerUser(data: any) {\r\n    try {\r\n        const supabase = createClient(\r\n            process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n            process.env.SUPABASE_SERVICE_ROLE_KEY!,\r\n            {\r\n                auth: {\r\n                    autoRefreshToken: false,\r\n                    persistSession: false\r\n                }\r\n            }\r\n        )\r\n\r\n        // 1. Crear usuario en Auth con auto-confirmaci√≥n\r\n        const { data: authUser, error: authError } = await supabase.auth.admin.createUser({\r\n            email: data.email,\r\n            password: data.password,\r\n            email_confirm: true,\r\n            user_metadata: {\r\n                first_name: data.first_name,\r\n                last_name: data.last_name,\r\n                full_name: `${data.first_name} ${data.last_name}`.trim()\r\n            }\r\n        })\r\n\r\n        if (authError) return { success: false, error: authError.message }\r\n        if (!authUser.user) return { success: false, error: 'No se pudo crear el usuario' }\r\n\r\n        // Force confirm email explicitly\r\n        await supabase.auth.admin.updateUserById(authUser.user.id, { email_confirm: true })\r\n\r\n        // 2. Crear perfil\r\n        const { error: profileError } = await supabase\r\n            .from('profiles')\r\n            .upsert({\r\n                id: authUser.user.id,\r\n                email: data.email,\r\n                first_name: data.first_name,\r\n                last_name: data.last_name,\r\n                whatsapp: data.whatsapp,\r\n                role: 'user'\r\n            })\r\n\r\n        if (profileError) {\r\n            console.error('Error creando perfil:', profileError)\r\n        }\r\n\r\n        return { success: true }\r\n    } catch (error) {\r\n        console.error('Error en registerUser:', error)\r\n        return { success: false, error: 'Error interno del servidor' }\r\n    }\r\n}\r\n\r\n/**\r\n * Deletes a user account and all associated data\r\n * This MUST run on the server with service_role_key for security\r\n */\r\nexport async function deleteUserAccount(userId: string) {\r\n    try {\r\n        const supabase = createClient(\r\n            process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n            process.env.SUPABASE_SERVICE_ROLE_KEY!,\r\n            {\r\n                auth: {\r\n                    autoRefreshToken: false,\r\n                    persistSession: false\r\n                }\r\n            }\r\n        )\r\n\r\n        // Delete user from auth (this will cascade delete related data via DB triggers/policies)\r\n        const { error } = await supabase.auth.admin.deleteUser(userId)\r\n\r\n        if (error) {\r\n            console.error('Error deleting user:', error)\r\n            return { success: false, error: error.message }\r\n        }\r\n\r\n        return { success: true }\r\n    } catch (error) {\r\n        console.error('Error en deleteUserAccount:', error)\r\n        return { success: false, error: 'Error interno del servidor' }\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAEA;;;;AAEO,eAAe,aAAa,IAAS;IACxC,IAAI;QACA,MAAM,WAAW,IAAA,yRAAY,gFAEzB,QAAQ,GAAG,CAAC,yBAAyB,EACrC;YACI,MAAM;gBACF,kBAAkB;gBAClB,gBAAgB;YACpB;QACJ;QAGJ,iDAAiD;QACjD,MAAM,EAAE,MAAM,QAAQ,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC;YAC9E,OAAO,KAAK,KAAK;YACjB,UAAU,KAAK,QAAQ;YACvB,eAAe;YACf,eAAe;gBACX,YAAY,KAAK,UAAU;gBAC3B,WAAW,KAAK,SAAS;gBACzB,WAAW,GAAG,KAAK,UAAU,CAAC,CAAC,EAAE,KAAK,SAAS,EAAE,CAAC,IAAI;YAC1D;QACJ;QAEA,IAAI,WAAW,OAAO;YAAE,SAAS;YAAO,OAAO,UAAU,OAAO;QAAC;QACjE,IAAI,CAAC,SAAS,IAAI,EAAE,OAAO;YAAE,SAAS;YAAO,OAAO;QAA8B;QAElF,iCAAiC;QACjC,MAAM,SAAS,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,SAAS,IAAI,CAAC,EAAE,EAAE;YAAE,eAAe;QAAK;QAEjF,kBAAkB;QAClB,MAAM,EAAE,OAAO,YAAY,EAAE,GAAG,MAAM,SACjC,IAAI,CAAC,YACL,MAAM,CAAC;YACJ,IAAI,SAAS,IAAI,CAAC,EAAE;YACpB,OAAO,KAAK,KAAK;YACjB,YAAY,KAAK,UAAU;YAC3B,WAAW,KAAK,SAAS;YACzB,UAAU,KAAK,QAAQ;YACvB,MAAM;QACV;QAEJ,IAAI,cAAc;YACd,QAAQ,KAAK,CAAC,yBAAyB;QAC3C;QAEA,OAAO;YAAE,SAAS;QAAK;IAC3B,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO;YAAE,SAAS;YAAO,OAAO;QAA6B;IACjE;AACJ;AAMO,eAAe,kBAAkB,MAAc;IAClD,IAAI;QACA,MAAM,WAAW,IAAA,yRAAY,gFAEzB,QAAQ,GAAG,CAAC,yBAAyB,EACrC;YACI,MAAM;gBACF,kBAAkB;gBAClB,gBAAgB;YACpB;QACJ;QAGJ,yFAAyF;QACzF,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC;QAEvD,IAAI,OAAO;YACP,QAAQ,KAAK,CAAC,wBAAwB;YACtC,OAAO;gBAAE,SAAS;gBAAO,OAAO,MAAM,OAAO;YAAC;QAClD;QAEA,OAAO;YAAE,SAAS;QAAK;IAC3B,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO;YAAE,SAAS;YAAO,OAAO;QAA6B;IACjE;AACJ;;;IApFsB;IA0DA;;AA1DA,sXAAA;AA0DA,sXAAA","debugId":null}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Home/Downloads/iptv/.next-internal/server/app/protected/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {deleteUserAccount as '40b65546487a310a529a766f83173f00e822f43548'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA","debugId":null}}]
}