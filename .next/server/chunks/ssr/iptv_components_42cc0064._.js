module.exports=[71004,a=>{"use strict";var b=a.i(27777),c=a.i(80344),d=a.i(83793),e=a.i(64858),f=a.i(81010);function g({user:a,profile:g}){let h=(0,f.useRouter)(),i=(0,e.createClient)(),j=async()=>{await i.auth.signOut(),h.push("/auth/login")},k=g?.first_name&&g?.last_name?`${g.first_name} ${g.last_name}`:g?.first_name?g.first_name:a?.email?a.email.split("@")[0]:"Usuario";return(0,b.jsx)("header",{className:"border-b border-border bg-card",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-4 flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-primary to-secondary rounded-lg flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-white font-bold text-lg",children:"üì∫"})}),(0,b.jsx)("h1",{className:"text-xl font-bold text-foreground",children:"MaxPlayer IPTV"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:k}),(0,b.jsx)(c.Button,{onClick:j,variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-foreground",children:(0,b.jsx)(d.LogOut,{className:"w-4 h-4"})})]})]})})}a.s(["HeaderNav",()=>g])},18683,a=>{"use strict";var b=a.i(27777),c=a.i(68009),d=a.i(73233);let e=(0,d.default)("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);var f=a.i(34582),g=a.i(13313);let h=(0,d.default)("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]),i=(0,d.default)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);function j({children:a,currentView:c,setCurrentView:d}){let j=[{id:"home",label:"Inicio",icon:e},{id:"plans",label:"Planes",icon:f.Tv},{id:"billing",label:"Facturaci√≥n",icon:g.FileText},{id:"credentials",label:"Credenciales",icon:h},{id:"settings",label:"Configuraci√≥n",icon:i}];return(0,b.jsxs)("div",{className:"flex gap-6 max-w-7xl mx-auto px-4 py-8",children:[(0,b.jsx)("aside",{className:"w-64 flex flex-col gap-2 sticky top-8 h-fit",children:(0,b.jsx)("nav",{className:"space-y-2",children:j.map(a=>{let e=a.icon,f=c===a.id;return(0,b.jsxs)("button",{onClick:()=>d(a.id),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg font-medium transition-colors ${f?"bg-primary text-primary-foreground":"text-foreground hover:bg-muted"}`,children:[(0,b.jsx)(e,{className:"w-5 h-5"}),(0,b.jsx)("span",{children:a.label})]},a.id)})})}),(0,b.jsx)("main",{className:"flex-1",children:a})]})}var k=a.i(6376),l=a.i(90505),l=l,m=a.i(12275),m=m,n=a.i(84885);let o=(0,d.default)("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var p=a.i(73050),q=a.i(32730),r=a.i(70193);let s=(0,d.default)("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]),t=(0,d.default)("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);var u=a.i(64858);function v(){let[a,b]=(0,c.useState)(null),[d,e]=(0,c.useState)(!0);return(0,c.useEffect)(()=>{let a=(0,u.createClient)();(async()=>{console.log("[useAuth] Fetching user...");try{let{data:{user:c}}=await a.auth.getUser();console.log("[useAuth] User fetched:",c?.email||"No user"),b(c)}finally{e(!1)}})();let{data:{subscription:c}}=a.auth.onAuthStateChange((a,c)=>{b(c?.user??null)});return()=>c?.unsubscribe()},[]),{user:a,loading:d}}function w(){let[a,b]=(0,c.useState)(null),[d,e]=(0,c.useState)(!0),[f,g]=(0,c.useState)(null),{user:h}=v(),i=(0,c.useCallback)(async()=>{if(console.log("[useSubscription] fetchSubscription called, user:",h?.email||"No user"),!h){console.log("[useSubscription] No user, skipping fetch"),b(null),e(!1);return}try{console.log("[useSubscription] Fetching subscription for user:",h.id),e(!0);let a=(0,u.createClient)(),{data:c,error:d}=await a.from("subscriptions").select(`
          *,
          plan:plans!subscriptions_plan_id_fkey (
            id,
            name,
            max_screens,
            price
          )
        `).eq("user_id",h.id).order("created_at",{ascending:!1}).limit(1).single();if(d&&"PGRST116"!==d.code)throw d;console.log("[useSubscription] Subscription fetched:",c?.plan_name||"No subscription"),b(c||null),g(null)}catch(a){console.error("[useSubscription] Error:",a),g(a instanceof Error?a.message:"Error fetching subscription")}finally{e(!1)}},[h]);return(0,c.useEffect)(()=>{i()},[i]),{subscription:a,loading:d,error:f,refetch:i}}var x=a.i(56024),y=a.i(96453);function z(){let[a,d]=(0,c.useState)([]),[e,f]=(0,c.useState)(!0),g=(0,c.useCallback)(async()=>{let a=(0,u.createBrowserClient)(),{data:{user:b}}=await a.auth.getUser();if(!b)return;let{data:c,error:e}=await a.from("notifications").select("*").eq("user_id",b.id).eq("read",!1).order("created_at",{ascending:!1});!e&&c&&d(c),f(!1)},[]);(0,c.useEffect)(()=>{g();let a=(0,u.createBrowserClient)(),b=a.channel("notifications-changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:"read=eq.false"},a=>{g()}).subscribe();return()=>{a.removeChannel(b)}},[g]);let h=async a=>{d(b=>b.filter(b=>b.id!==a));let b=(0,u.createBrowserClient)();await b.from("notifications").update({read:!0}).eq("id",a)};return e||0===a.length?null:(0,b.jsx)("div",{className:"space-y-3 mb-6",children:a.map(a=>(0,b.jsxs)("div",{className:`relative flex items-start gap-4 p-4 rounded-lg border ${(a=>{switch(a){case"success":return"border-green-200 bg-green-50 dark:bg-green-900/20 dark:border-green-900";case"warning":return"border-orange-200 bg-orange-50 dark:bg-orange-900/20 dark:border-orange-900";case"error":return"border-red-200 bg-red-50 dark:bg-red-900/20 dark:border-red-900";default:return"border-blue-200 bg-blue-50 dark:bg-blue-900/20 dark:border-blue-900"}})(a.type)} shadow-sm transition-all animate-in fade-in slide-in-from-top-2`,children:[(0,b.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:(a=>{switch(a){case"success":return(0,b.jsx)(q.CheckCircle,{className:"h-5 w-5 text-green-600"});case"warning":return(0,b.jsx)(p.AlertTriangle,{className:"h-5 w-5 text-orange-600"});case"error":return(0,b.jsx)(y.AlertCircle,{className:"h-5 w-5 text-red-600"});default:return(0,b.jsx)(r.Info,{className:"h-5 w-5 text-blue-600"})}})(a.type)}),(0,b.jsxs)("div",{className:"flex-1 mr-6",children:[(0,b.jsx)("h4",{className:"font-semibold text-sm mb-1",children:a.title}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground leading-relaxed",children:a.message}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground/60 mt-2",children:[new Date(a.created_at).toLocaleDateString()," ‚Ä¢ ",new Date(a.created_at).toLocaleTimeString()]})]}),(0,b.jsx)("button",{onClick:()=>h(a.id),className:"absolute top-3 right-3 p-1 rounded-full hover:bg-black/5 dark:hover:bg-white/10 transition-colors","aria-label":"Cerrar notificaci√≥n",children:(0,b.jsx)(x.X,{className:"h-4 w-4 text-muted-foreground"})})]},a.id))})}function A({setCurrentView:a}){let{subscription:d,loading:e}=w(),[g,i]=(0,c.useState)(!1),[j,v]=(0,c.useState)([]);(0,c.useEffect)(()=>{e||g||i(!0)},[e,g]),(0,c.useEffect)(()=>{x()},[]);let x=async()=>{let a=(0,u.createClient)(),b=new Date().toISOString(),{data:c,error:d}=await a.from("promotions").select("*").eq("active",!0).or(`start_date.is.null,start_date.lte.${b}`).or(`end_date.is.null,end_date.gte.${b}`);!d&&c&&v(c)},y=d?Math.ceil((new Date(d.next_billing_date).getTime()-Date.now())/864e5):0,A=d?.plan?.max_screens||1,B=2/A*100,C=a=>new Date(a).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),D=d&&"active"===d.status?y<=2?{variant:"warning",icon:p.AlertTriangle,title:"Renovaci√≥n Pr√≥xima",message:`Tu suscripci\xf3n caduca en ${y} d\xeda${1===y?"":"s"}. Aseg\xfarate de que tu m\xe9todo de pago est\xe9 actualizado.`,bgColor:"bg-orange-50 dark:bg-orange-950/30",borderColor:"border-orange-200 dark:border-orange-900",iconColor:"text-orange-600 dark:text-orange-400"}:y<=7?{variant:"info",icon:r.Info,title:"Informaci√≥n",message:`Tu suscripci\xf3n se renovar\xe1 en ${y} d\xedas. Tu pr\xf3xima facturaci\xf3n es el ${C(d.next_billing_date)}.`,bgColor:"bg-blue-50 dark:bg-blue-950/30",borderColor:"border-blue-200 dark:border-blue-900",iconColor:"text-blue-600 dark:text-blue-400"}:{variant:"success",icon:q.CheckCircle,title:"Todo en Orden",message:"Tu suscripci√≥n est√° activa y funcionando correctamente. Para cualquier inconveniente, contacta a nuestro soporte.",bgColor:"bg-green-50 dark:bg-green-950/30",borderColor:"border-green-200 dark:border-green-900",iconColor:"text-green-600 dark:text-green-400"}:{variant:"destructive",icon:p.AlertTriangle,title:"Atenci√≥n Requerida",message:"Tu suscripci√≥n no est√° activa. Por favor contacta a soporte o renueva tu plan.",bgColor:"bg-red-50 dark:bg-red-950/30",borderColor:"border-red-200 dark:border-red-900",iconColor:"text-red-600 dark:text-red-400"},E=D.icon;return e&&!g?(0,b.jsx)("div",{className:"text-center py-8",children:"Cargando informaci√≥n..."}):(0,b.jsxs)("div",{className:"space-y-8",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-3xl font-bold text-foreground mb-2",children:"Bienvenido de vuelta"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Aqu√≠ est√° el resumen de tu cuenta"})]}),(0,b.jsx)(z,{}),j.length>0&&(0,b.jsx)(k.Card,{className:"p-4 border-2 border-orange-500 bg-gradient-to-r from-orange-50 to-amber-50 dark:from-orange-950/30 dark:to-amber-950/30 shadow-lg",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"w-12 h-12 bg-orange-500 rounded-full flex items-center justify-center flex-shrink-0",children:(0,b.jsx)(t,{className:"w-6 h-6 text-white"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("h3",{className:"font-bold text-orange-900 dark:text-orange-100 mb-1 text-lg",children:["üéâ ¬°Promoci√≥n Activa! ",j[0].name]}),(0,b.jsx)("p",{className:"text-sm text-orange-700 dark:text-orange-200 mb-3",children:j[0].description}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"inline-flex items-center gap-2 bg-orange-600 text-white px-4 py-2 rounded-full text-sm font-semibold shadow-md",children:j[0].discount_percentage?(0,b.jsxs)(b.Fragment,{children:[j[0].discount_percentage,"% de descuento"]}):(0,b.jsxs)(b.Fragment,{children:["S/ ",j[0].discount_amount," de descuento"]})}),(0,b.jsx)("button",{onClick:()=>a("plans"),className:"text-sm text-orange-700 dark:text-orange-200 hover:text-orange-900 dark:hover:text-orange-100 font-semibold underline",children:"Ver planes ‚Üí"})]})]})]})}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,b.jsx)(k.Card,{className:"p-6 border border-border bg-card hover:shadow-lg transition-shadow",children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Plan Actual"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-foreground",children:d?.plan_name||"Sin plan"}),(0,b.jsx)("p",{className:"text-xs text-accent mt-2",children:d?.status==="active"?"Activo":"Inactivo"})]}),(0,b.jsx)("div",{className:"w-12 h-12 bg-accent/10 rounded-lg flex items-center justify-center",children:(0,b.jsx)(f.Tv,{className:"w-6 h-6 text-accent"})})]})}),(0,b.jsx)(k.Card,{className:"p-6 border border-border bg-card hover:shadow-lg transition-shadow",children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Pr√≥xima Facturaci√≥n"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-foreground",children:d?C(d.next_billing_date):"N/A"}),(0,b.jsxs)("p",{className:"text-xs text-green-600 mt-2 flex items-center gap-1",children:[(0,b.jsx)(m.default,{className:"w-3 h-3"})," ",d?.status==="active"?"Activo":"Inactivo"]})]}),(0,b.jsx)("div",{className:"w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center",children:(0,b.jsx)(m.default,{className:"w-6 h-6 text-green-600"})})]})}),(0,b.jsx)(k.Card,{className:"p-6 border border-border bg-card hover:shadow-lg transition-shadow cursor-pointer",onClick:()=>{a("settings"),setTimeout(()=>{document.getElementById("devices-section")?.scrollIntoView({behavior:"smooth",block:"start"})},100)},children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Dispositivos Conectados"}),(0,b.jsxs)("p",{className:"text-2xl font-bold text-foreground",children:[2," de ",A]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-2",children:"Dispositivos activos"})]}),(0,b.jsxs)("div",{className:"relative w-16 h-16 flex-shrink-0",children:[(0,b.jsxs)("svg",{className:"w-full h-full transform -rotate-90",viewBox:"0 0 36 36",children:[(0,b.jsx)("circle",{cx:"18",cy:"18",r:"16",fill:"none",className:"stroke-muted",strokeWidth:"3"}),(0,b.jsx)("circle",{cx:"18",cy:"18",r:"16",fill:"none",className:"stroke-accent",strokeWidth:"3",strokeDasharray:`${B} 100`,strokeLinecap:"round"})]}),(0,b.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,b.jsx)(s,{className:"w-6 h-6 text-accent"})})]})]})})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:"Acciones R√°pidas"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsx)(k.Card,{className:"p-4 border border-border bg-card hover:bg-muted/50 transition-colors cursor-pointer",onClick:()=>a("plans"),children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 bg-accent/10 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,b.jsx)(f.Tv,{className:"w-5 h-5 text-accent"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-foreground",children:"Cambiar de Plan"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Actualiza a un plan superior"})]})]}),(0,b.jsx)(l.default,{className:"w-5 h-5 text-muted-foreground"})]})}),(0,b.jsx)(k.Card,{className:"p-4 border border-border bg-card hover:bg-muted/50 transition-colors cursor-pointer",onClick:()=>a("billing"),children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,b.jsx)(n.CreditCard,{className:"w-5 h-5 text-primary"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-foreground",children:"Ver Facturas"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Historial de pagos"})]})]}),(0,b.jsx)(l.default,{className:"w-5 h-5 text-muted-foreground"})]})}),(0,b.jsx)(k.Card,{className:"p-4 border border-border bg-card hover:bg-muted/50 transition-colors cursor-pointer",onClick:()=>a("credentials"),children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,b.jsx)(h,{className:"w-5 h-5 text-green-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-foreground",children:"Ver Credenciales"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Tu usuario y contrase√±a"})]})]}),(0,b.jsx)(l.default,{className:"w-5 h-5 text-muted-foreground"})]})}),(0,b.jsx)(k.Card,{className:"p-4 border border-border bg-card hover:bg-muted/50 transition-colors cursor-pointer",onClick:()=>a("support"),children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,b.jsx)(o,{className:"w-5 h-5 text-blue-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-foreground",children:"Soporte T√©cnico"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Contacta a nuestro equipo"})]})]}),(0,b.jsx)(l.default,{className:"w-5 h-5 text-muted-foreground"})]})})]})]}),(0,b.jsx)(k.Card,{className:`p-4 border ${D.borderColor} ${D.bgColor}`,children:(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)(E,{className:`w-5 h-5 ${D.iconColor} flex-shrink-0 mt-0.5`}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-foreground mb-1",children:D.title}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:D.message})]})]})})]})}var B=a.i(80344),C=a.i(95773),D=a.i(44790),m=m;let E=(0,d.default)("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),F=(0,d.default)("Crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]),G=(0,d.default)("Rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]),H=(0,d.default)("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);var I=a.i(36472),J=a.i(52059);let K={basic:E,premium:F,"premium-plus":G};function L({setCurrentView:a}){let[d,e]=(0,c.useState)(null),[f,g]=(0,c.useState)(!1),[h,i]=(0,c.useState)(!1),[j,l]=(0,c.useState)(""),[n,o]=(0,c.useState)(null),[p,q]=(0,c.useState)([]),[r,s]=(0,c.useState)(!1),{subscription:v,refetch:y}=w(),{plans:z,loading:A}=function(){let[a,b]=(0,c.useState)([]),[d,e]=(0,c.useState)(!0),[f,g]=(0,c.useState)(null);return(0,c.useEffect)(()=>{!async function(){try{e(!0);let a=(0,u.createClient)(),{data:c,error:d}=await a.from("plans").select("*").order("price",{ascending:!0});if(d)throw d;b(c||[]),g(null)}catch(a){g(a instanceof Error?a.message:"Error fetching plans")}finally{e(!1)}}()},[]),{plans:a,loading:d,error:f}}(),{toast:G}=(0,I.useToast)(),L=v?.plan_id||"basic";(0,c.useEffect)(()=>{M()},[]);let M=async()=>{let a=(0,u.createClient)(),b=new Date().toISOString(),{data:c,error:d}=await a.from("promotions").select("*").eq("active",!0).or(`start_date.is.null,start_date.lte.${b}`).or(`end_date.is.null,end_date.gte.${b}`);!d&&c&&q(c)},N=async()=>{if(!j.trim())return void G({title:"C√≥digo requerido",description:"Por favor ingresa un c√≥digo de cup√≥n",variant:"destructive",duration:3e3});s(!0);let a=(0,u.createClient)(),b=new Date().toISOString(),{data:c,error:d}=await a.from("coupons").select("*").eq("code",j.toUpperCase()).eq("active",!0).single();if(d||!c){G({title:"Cup√≥n inv√°lido",description:"El c√≥digo ingresado no existe o ha expirado",variant:"destructive",duration:3e3}),s(!1);return}if(c.start_date&&new Date(c.start_date)>new Date(b)){G({title:"Cup√≥n no disponible",description:"Este cup√≥n a√∫n no est√° disponible",variant:"destructive",duration:3e3}),s(!1);return}if(c.end_date&&new Date(c.end_date)<new Date(b)){G({title:"Cup√≥n expirado",description:"Este cup√≥n ya no est√° disponible",variant:"destructive",duration:3e3}),s(!1);return}if(c.max_uses&&c.current_uses>=c.max_uses){G({title:"Cup√≥n agotado",description:"Este cup√≥n ya alcanz√≥ su l√≠mite de usos",variant:"destructive",duration:3e3}),s(!1);return}o(c),G({title:"Cup√≥n aplicado",description:`Has obtenido un descuento de ${c.discount_percentage?`${c.discount_percentage}%`:`S/ ${c.discount_amount}`}`,variant:"success",duration:3e3}),s(!1)},O=a=>{let b=a;if(p.length>0){let a=p[0];a.discount_percentage?b-=b*a.discount_percentage/100:a.discount_amount&&(b-=a.discount_amount)}return n&&(n.discount_percentage?b-=b*n.discount_percentage/100:n.discount_amount&&(b-=n.discount_amount)),Math.max(0,b)},P=async()=>{if(d&&v){g(!0);try{let a=(0,u.createClient)(),b=z.find(a=>a.id===d);if(!b)throw Error("Plan no encontrado");let c=O(b.price),{error:f}=await a.from("subscriptions").update({plan_id:b.id,plan_name:b.name,price:c,updated_at:new Date().toISOString()}).eq("user_id",v.user_id);if(f)throw f;n&&await a.from("coupons").update({current_uses:n.current_uses+1}).eq("id",n.id),await a.from("invoices").insert({user_id:v.user_id,amount:c,status:"paid",description:`Cambio a ${b.name}${n?` (Cup\xf3n: ${n.code})`:""}${p.length>0?` (Promoci\xf3n aplicada)`:""}`,invoice_date:new Date().toISOString()}),await y(),G({title:"Plan actualizado exitosamente",description:`Te hemos cambiado al plan ${b.name}${c<b.price?" con descuento aplicado":""}.`,variant:"success",duration:3e3}),i(!1),e(null),o(null),l("")}catch(a){console.error("Error cambiando plan:",a),G({title:"Error al cambiar plan",description:"No se pudo cambiar el plan. Por favor, intenta de nuevo.",variant:"destructive",duration:3e3})}finally{g(!1)}}};return A?(0,b.jsx)("div",{className:"space-y-8",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-3xl font-bold text-foreground mb-2",children:"Planes y Suscripci√≥n"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Cargando planes disponibles..."})]})}):(0,b.jsxs)("div",{className:"space-y-8",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-3xl font-bold text-foreground mb-2",children:"Planes y Suscripci√≥n"}),(0,b.jsxs)("p",{className:"text-muted-foreground",children:["Tu plan actual: ",(0,b.jsx)("span",{className:"font-semibold text-primary",children:v?.plan_name||"Cargando..."})]})]}),p.length>0&&(0,b.jsx)(k.Card,{className:"p-4 border-2 border-orange-500 bg-orange-50",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(t,{className:"w-6 h-6 text-orange-600 flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("h3",{className:"font-bold text-orange-900 mb-1",children:["¬°Promoci√≥n Activa! ",p[0].name]}),(0,b.jsx)("p",{className:"text-sm text-orange-700 mb-2",children:p[0].description}),(0,b.jsx)("div",{className:"inline-flex items-center gap-2 bg-orange-600 text-white px-3 py-1 rounded-full text-sm font-semibold",children:p[0].discount_percentage?(0,b.jsxs)(b.Fragment,{children:[p[0].discount_percentage,"% de descuento"]}):(0,b.jsxs)(b.Fragment,{children:["S/ ",p[0].discount_amount," de descuento"]})})]})]})}),(0,b.jsxs)(k.Card,{className:"p-6 bg-gradient-to-r from-green-50 to-emerald-50 border-green-200",children:[(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-end",children:[(0,b.jsxs)("div",{className:"flex-1 w-full",children:[(0,b.jsxs)(D.Label,{htmlFor:"coupon-code",className:"text-green-900 font-semibold flex items-center gap-2 mb-2",children:[(0,b.jsx)(H,{className:"w-4 h-4"}),"¬øTienes un c√≥digo de cup√≥n?"]}),(0,b.jsx)(C.Input,{id:"coupon-code",placeholder:"Ingresa tu c√≥digo",value:j,onChange:a=>l(a.target.value.toUpperCase()),disabled:!!n||r,className:"uppercase"})]}),n?(0,b.jsx)(B.Button,{onClick:()=>{o(null),l(""),G({title:"Cup√≥n removido",description:"El cup√≥n ha sido removido",duration:3e3})},variant:"outline",className:"border-green-600 text-green-600",children:"Remover Cup√≥n"}):(0,b.jsx)(B.Button,{onClick:N,disabled:r||!j.trim(),className:"bg-green-600 hover:bg-green-700 text-white",children:r?"Validando...":"Aplicar Cup√≥n"})]}),n&&(0,b.jsxs)("div",{className:"mt-3 flex items-center gap-2 text-sm text-green-700 bg-green-100 px-3 py-2 rounded-lg",children:[(0,b.jsx)(m.default,{className:"w-4 h-4"}),(0,b.jsxs)("span",{className:"font-semibold",children:['Cup√≥n "',n.code,'" aplicado exitosamente']})]})]}),(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:z.map(a=>{let c=K[a.id]||E,d=L===a.id,g=Array.isArray(a.features)?a.features:JSON.parse(a.features||"[]"),h=a.price,j=O(h),l=j<h;return(0,b.jsxs)(k.Card,{className:`relative overflow-hidden transition-all duration-300 flex flex-col ${d?"border-2 border-primary shadow-lg":"border border-border hover:border-primary/50 hover:shadow-md"}`,children:[d&&(0,b.jsxs)("div",{className:"absolute top-0 left-0 right-0 bg-gradient-to-r from-primary to-accent text-white px-3 py-1.5 text-center font-semibold text-xs",children:[(0,b.jsx)(m.default,{className:"w-3 h-3 inline mr-1"}),"TU PLAN ACTUAL"]}),(0,b.jsxs)("div",{className:`p-5 flex flex-col flex-1 ${d?"pt-10":""}`,children:[(0,b.jsxs)("div",{className:"flex items-start gap-3 mb-4",children:[(0,b.jsx)("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center shrink-0 ${d?"bg-primary/10":"bg-muted"}`,children:(0,b.jsx)(c,{className:`w-5 h-5 ${d?"text-primary":"text-muted-foreground"}`})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("h3",{className:"text-lg font-bold text-foreground mb-0.5 truncate",children:a.name}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground line-clamp-1",children:a.description})]})]}),(0,b.jsx)("div",{className:"mb-4 pb-4 border-b",children:l?(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("span",{className:"text-sm text-muted-foreground line-through",children:["$",h]}),(0,b.jsxs)("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full font-semibold",children:["-",((h-j)/h*100).toFixed(0),"%"]})]}),(0,b.jsxs)("div",{className:"flex items-baseline gap-1",children:[(0,b.jsxs)("span",{className:"text-3xl font-bold text-green-600",children:["$",j.toFixed(2)]}),(0,b.jsx)("span",{className:"text-sm text-green-600",children:"/mes"})]})]}):(0,b.jsxs)("div",{className:"flex items-baseline gap-1",children:[(0,b.jsxs)("span",{className:"text-3xl font-bold text-foreground",children:["$",a.price]}),(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"/mes"})]})}),(0,b.jsxs)("ul",{className:"space-y-2 mb-5 flex-1",children:[g.slice(0,6).map((a,c)=>(0,b.jsxs)("li",{className:"flex items-start gap-2 text-sm",children:[(0,b.jsx)(m.default,{className:`w-4 h-4 shrink-0 mt-0.5 ${d?"text-primary":"text-green-600"}`}),(0,b.jsx)("span",{className:"text-foreground/90 leading-tight",children:a})]},c)),g.length>6&&(0,b.jsxs)("li",{className:"text-xs text-muted-foreground italic pl-6",children:["+",g.length-6," caracter√≠sticas m√°s"]})]}),(0,b.jsx)(B.Button,{onClick:()=>{var b;(b=a.id)===L?G({title:"Plan actual",description:"Ya tienes este plan activo",variant:"destructive",duration:3e3}):(e(b),i(!0))},disabled:f||d,className:`w-full ${d?"bg-gradient-to-r from-primary to-accent text-white cursor-default":"bg-primary text-primary-foreground hover:bg-primary/90"}`,children:d?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(m.default,{className:"w-4 h-4 mr-2"}),"Plan Activo"]}):"Seleccionar Plan"})]})]},a.id)})}),(0,b.jsx)(J.Dialog,{open:h,onOpenChange:i,children:(0,b.jsxs)(J.DialogContent,{className:"sm:max-w-[500px]",children:[(0,b.jsxs)(J.DialogHeader,{children:[(0,b.jsxs)(J.DialogTitle,{className:"text-2xl flex items-center gap-2",children:[(0,b.jsx)(F,{className:"w-6 h-6 text-primary"}),"Confirmar Cambio de Plan"]}),(0,b.jsxs)("div",{className:"text-muted-foreground text-base pt-4 space-y-4",children:[(0,b.jsxs)("p",{children:["Est√°s a punto de cambiar al plan"," ",(0,b.jsx)("span",{className:"font-semibold text-primary",children:z.find(a=>a.id===d)?.name}),"."]}),(0,b.jsx)("div",{className:"bg-muted rounded-lg p-4 space-y-2",children:d&&(()=>{let a=z.find(a=>a.id===d);if(!a)return null;let c=a.price,e=O(c),f=e<c;return(0,b.jsxs)(b.Fragment,{children:[f&&(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Precio original:"}),(0,b.jsxs)("span",{className:"line-through text-muted-foreground",children:["$",c,"/mes"]})]}),p.length>0&&(0,b.jsxs)("div",{className:"flex justify-between text-sm text-orange-600",children:[(0,b.jsx)("span",{children:"Promoci√≥n activa:"}),(0,b.jsxs)("span",{className:"font-semibold",children:["-",p[0].discount_percentage?`${p[0].discount_percentage}%`:`$${p[0].discount_amount}`]})]}),n&&(0,b.jsxs)("div",{className:"flex justify-between text-sm text-green-600",children:[(0,b.jsxs)("span",{children:["Cup√≥n (",n.code,"):"]}),(0,b.jsxs)("span",{className:"font-semibold",children:["-",n.discount_percentage?`${n.discount_percentage}%`:`$${n.discount_amount}`]})]}),(0,b.jsxs)("div",{className:"flex justify-between text-sm border-t pt-2",children:[(0,b.jsx)("span",{className:"font-semibold text-foreground",children:"Precio final:"}),(0,b.jsxs)("span",{className:`font-bold text-lg ${f?"text-green-600":"text-foreground"}`,children:["$",e.toFixed(2),"/mes"]})]}),f&&(0,b.jsxs)("div",{className:"text-center text-xs text-green-600 font-semibold bg-green-50 py-1 rounded",children:["¬°Ahorras $",(c-e).toFixed(2)," al mes!"]})]})})()}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"El cambio se aplicar√° inmediatamente. Se te cobrar√° la nueva tarifa de forma proporcional."})]})]}),(0,b.jsxs)(J.DialogFooter,{className:"gap-3 sm:gap-3 flex-col sm:flex-row",children:[(0,b.jsxs)(B.Button,{type:"button",variant:"outline",onClick:()=>{i(!1),e(null)},disabled:f,className:"w-full sm:flex-1",children:[(0,b.jsx)(x.X,{className:"w-4 h-4 mr-2"}),"Cancelar"]}),(0,b.jsx)(B.Button,{type:"button",onClick:P,disabled:f,className:"w-full sm:flex-1 bg-gradient-to-r from-primary to-accent text-white hover:from-primary/90 hover:to-accent/90",children:f?"Procesando...":(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(m.default,{className:"w-4 h-4 mr-2"}),"Confirmar Cambio"]})})]})]})}),(0,b.jsxs)(k.Card,{className:"p-6 border border-border bg-card",children:[(0,b.jsx)("h3",{className:"text-xl font-bold text-foreground mb-4",children:"¬øNecesitas ayuda para elegir?"}),(0,b.jsx)("p",{className:"text-muted-foreground mb-4",children:"Todos nuestros planes incluyen acceso a m√°s de 1000 canales internacionales, VOD ilimitado y compatibilidad con todos los dispositivos populares."}),(0,b.jsx)(B.Button,{variant:"outline",children:"Contactar Soporte"})]})]})}let M=(0,d.default)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);var N=a.i(60749);let O=(0,d.default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);var P=a.i(27709),Q=a.i(15863),R=a.i(27992);function S(){let{user:a}=v(),[b,d]=(0,c.useState)(null),[e,f]=(0,c.useState)(!0),[g,h]=(0,c.useState)(null),i=async()=>{if(!a)return void f(!1);try{f(!0);let b=(0,u.createClient)(),{data:c,error:e}=await b.from("profiles").select("*").eq("id",a.id).single();if(e)throw e;d(c),h(null)}catch(a){console.error("Error fetching profile:",a),h(a instanceof Error?a.message:"Error desconocido")}finally{f(!1)}},j=async b=>{if(!a)return{error:"No hay usuario autenticado"};try{let c=(0,u.createClient)(),{error:d}=await c.from("profiles").update(b).eq("id",a.id);if(d)throw d;return await i(),{error:null}}catch(a){return console.error("Error updating profile:",a),{error:a instanceof Error?a.message:"Error actualizando perfil"}}};return(0,c.useEffect)(()=>{i()},[a]),{profile:b,loading:e,error:g,updateProfile:j,refetch:i}}var T=a.i(3177);let U=[{code:"+51",country:"Per√∫",flag:"üáµüá™",maxDigits:9},{code:"+1",country:"Estados Unidos/Canad√°",flag:"üá∫üá∏",maxDigits:10},{code:"+52",country:"M√©xico",flag:"üá≤üáΩ",maxDigits:10},{code:"+34",country:"Espa√±a",flag:"üá™üá∏",maxDigits:9},{code:"+54",country:"Argentina",flag:"üá¶üá∑",maxDigits:10},{code:"+57",country:"Colombia",flag:"üá®üá¥",maxDigits:10},{code:"+55",country:"Brasil",flag:"üáßüá∑",maxDigits:11},{code:"+56",country:"Chile",flag:"üá®üá±",maxDigits:9},{code:"+49",country:"Alemania",flag:"üá©üá™",maxDigits:11},{code:"+213",country:"Argelia",flag:"üá©üáø",maxDigits:9},{code:"+966",country:"Arabia Saudita",flag:"üá∏üá¶",maxDigits:9},{code:"+61",country:"Australia",flag:"üá¶üá∫",maxDigits:9},{code:"+43",country:"Austria",flag:"üá¶üáπ",maxDigits:10},{code:"+32",country:"B√©lgica",flag:"üáßüá™",maxDigits:9},{code:"+591",country:"Bolivia",flag:"üáßüá¥",maxDigits:8},{code:"+86",country:"China",flag:"üá®üá≥",maxDigits:11},{code:"+82",country:"Corea del Sur",flag:"üá∞üá∑",maxDigits:10},{code:"+506",country:"Costa Rica",flag:"üá®üá∑",maxDigits:8},{code:"+53",country:"Cuba",flag:"üá®üá∫",maxDigits:8},{code:"+45",country:"Dinamarca",flag:"üá©üá∞",maxDigits:8},{code:"+593",country:"Ecuador",flag:"üá™üá®",maxDigits:9},{code:"+20",country:"Egipto",flag:"üá™üá¨",maxDigits:10},{code:"+503",country:"El Salvador",flag:"üá∏üáª",maxDigits:8},{code:"+971",country:"Emiratos √Årabes",flag:"üá¶üá™",maxDigits:9},{code:"+63",country:"Filipinas",flag:"üáµüá≠",maxDigits:10},{code:"+358",country:"Finlandia",flag:"üá´üáÆ",maxDigits:10},{code:"+33",country:"Francia",flag:"üá´üá∑",maxDigits:9},{code:"+502",country:"Guatemala",flag:"üá¨üáπ",maxDigits:8},{code:"+594",country:"Guayana Francesa",flag:"üá¨üá´",maxDigits:9},{code:"+592",country:"Guyana",flag:"üá¨üáæ",maxDigits:7},{code:"+509",country:"Hait√≠",flag:"üá≠üáπ",maxDigits:8},{code:"+504",country:"Honduras",flag:"üá≠üá≥",maxDigits:8},{code:"+91",country:"India",flag:"üáÆüá≥",maxDigits:10},{code:"+62",country:"Indonesia",flag:"üáÆüá©",maxDigits:11},{code:"+972",country:"Israel",flag:"üáÆüá±",maxDigits:9},{code:"+39",country:"Italia",flag:"üáÆüáπ",maxDigits:10},{code:"+81",country:"Jap√≥n",flag:"üáØüáµ",maxDigits:10},{code:"+254",country:"Kenia",flag:"üá∞üá™",maxDigits:10},{code:"+60",country:"Malasia",flag:"üá≤üáæ",maxDigits:10},{code:"+212",country:"Marruecos",flag:"üá≤üá¶",maxDigits:9},{code:"+505",country:"Nicaragua",flag:"üá≥üáÆ",maxDigits:8},{code:"+234",country:"Nigeria",flag:"üá≥üá¨",maxDigits:10},{code:"+47",country:"Noruega",flag:"üá≥üá¥",maxDigits:8},{code:"+64",country:"Nueva Zelanda",flag:"üá≥üáø",maxDigits:9},{code:"+31",country:"Pa√≠ses Bajos",flag:"üá≥üá±",maxDigits:9},{code:"+507",country:"Panam√°",flag:"üáµüá¶",maxDigits:8},{code:"+595",country:"Paraguay",flag:"üáµüáæ",maxDigits:9},{code:"+351",country:"Portugal",flag:"üáµüáπ",maxDigits:9},{code:"+1-787",country:"Puerto Rico",flag:"üáµüá∑",maxDigits:10},{code:"+44",country:"Reino Unido",flag:"üá¨üáß",maxDigits:10},{code:"+1-809",country:"Rep√∫blica Dominicana",flag:"üá©üá¥",maxDigits:10},{code:"+7",country:"Rusia",flag:"üá∑üá∫",maxDigits:10},{code:"+65",country:"Singapur",flag:"üá∏üá¨",maxDigits:8},{code:"+27",country:"Sud√°frica",flag:"üáøüá¶",maxDigits:9},{code:"+46",country:"Suecia",flag:"üá∏üá™",maxDigits:9},{code:"+41",country:"Suiza",flag:"üá®üá≠",maxDigits:9},{code:"+66",country:"Tailandia",flag:"üáπüá≠",maxDigits:9},{code:"+216",country:"T√∫nez",flag:"üáπüá≥",maxDigits:8},{code:"+90",country:"Turqu√≠a",flag:"üáπüá∑",maxDigits:10},{code:"+598",country:"Uruguay",flag:"üá∫üáæ",maxDigits:8},{code:"+58",country:"Venezuela",flag:"üáªüá™",maxDigits:10},{code:"+84",country:"Vietnam",flag:"üáªüá≥",maxDigits:10}];function V(){let a,[d,e]=(0,c.useState)(!1),[f,h]=(0,c.useState)(!1),{invoices:i,loading:j}=function(){let[a,b]=(0,c.useState)([]),[d,e]=(0,c.useState)(!0),[f,g]=(0,c.useState)(null),{user:h}=v();return(0,c.useEffect)(()=>{if(!h){b([]),e(!1);return}(async()=>{try{let a=(0,u.createClient)(),{data:c,error:d}=await a.from("invoices").select("*").eq("user_id",h.id).order("invoice_date",{ascending:!1});if(d)throw d;b(c||[])}catch(a){g(a instanceof Error?a.message:"Error fetching invoices")}finally{e(!1)}})()},[h]),{invoices:a,loading:d,error:f}}(),{profile:l,loading:m,updateProfile:o}=S(),{subscription:p,loading:q}=w(),{toast:r}=(0,I.useToast)(),[s,t]=(0,c.useState)({firstName:"",lastName:"",email:"",countryCode:"+51",phoneNumber:""}),[x,y]=(0,c.useState)("");(0,c.useEffect)(()=>{if(f){let a=(()=>{if(!l)return null;let a="+51",b="";if(l.whatsapp){let c=l.whatsapp.trim(),d=U.find(a=>c.startsWith(a.code));d?(a=d.code,b=c.substring(d.code.length).replace(/\D/g,"")):b=c.replace(/\D/g,"")}return{firstName:l.first_name||"",lastName:l.last_name||"",email:l.email||"",countryCode:a,phoneNumber:b}})();a&&t(a)}},[f]);let z=a=>new Date(a).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),A=()=>{let a=U.find(a=>a.code===s.countryCode);return a?.maxDigits||15},E=()=>{let a=U.find(a=>a.code===s.countryCode);return a&&s.phoneNumber&&s.phoneNumber.length!==a.maxDigits?`Para ${a.country} se requieren exactamente ${a.maxDigits} d\xedgitos`:""},F=async()=>{var a;if(!s.email||(a=s.email,!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a))){y("Por favor ingresa un correo electr√≥nico v√°lido"),r({variant:"destructive",title:"Error de validaci√≥n",description:"El correo electr√≥nico no tiene un formato v√°lido",duration:3e3});return}y("");let b=E();if(s.phoneNumber&&b)return void r({variant:"destructive",title:"Error de validaci√≥n",description:b,duration:3e3});let c=s.phoneNumber?`${s.countryCode}${s.phoneNumber.replace(/\s/g,"")}`:"",{error:d}=await o({first_name:s.firstName,last_name:s.lastName,email:s.email,whatsapp:c});d?r({variant:"destructive",title:"Error",description:"No se pudo actualizar la informaci√≥n: "+d,duration:3e3}):(r({variant:"success",title:"‚úì Informaci√≥n actualizada",description:"Tu informaci√≥n de contacto se ha guardado correctamente",duration:3e3}),h(!1))};return j&&0===i.length?(0,b.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,b.jsxs)("div",{className:"text-center space-y-3",children:[(0,b.jsx)("div",{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Cargando informaci√≥n de facturaci√≥n..."})]})}):(0,b.jsxs)("div",{className:"space-y-8",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-3xl font-bold text-foreground mb-2",children:"Facturaci√≥n"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Gestiona tu cuenta de facturaci√≥n y pagos"})]}),p&&(0,b.jsxs)(k.Card,{className:"p-6 border border-border bg-gradient-to-br from-primary/5 to-primary/10",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,b.jsx)(Q.Calendar,{className:"w-5 h-5 text-primary"}),(0,b.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:"Pr√≥ximo Pago"})]}),(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4 p-4 bg-background/80 rounded-lg border border-border",children:[(0,b.jsx)("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center",children:(0,b.jsx)(R.DollarSign,{className:"w-6 h-6 text-primary"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Monto a Pagar"}),(0,b.jsxs)("p",{className:"text-2xl font-bold text-foreground",children:["$",p.price.toFixed(2)]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4 p-4 bg-background/80 rounded-lg border border-border",children:[(0,b.jsx)("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center",children:(0,b.jsx)(Q.Calendar,{className:"w-6 h-6 text-primary"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Fecha de Renovaci√≥n"}),(0,b.jsx)("p",{className:"text-lg font-semibold text-foreground",children:z(p.next_billing_date)})]})]})]}),(0,b.jsx)("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-950/30 rounded-lg border border-blue-200 dark:border-blue-800",children:(0,b.jsxs)("p",{className:"text-sm text-blue-800 dark:text-blue-400 flex items-start gap-2",children:[(0,b.jsx)(N.CheckCircle2,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),(0,b.jsx)("span",{children:"Tu suscripci√≥n se renovar√° autom√°ticamente. El cargo se realizar√° el d√≠a de la renovaci√≥n."})]})})]}),(0,b.jsxs)(k.Card,{className:"p-6 border border-border bg-card",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,b.jsx)(n.CreditCard,{className:"w-5 h-5 text-primary"}),(0,b.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:"M√©todo de Pago"})]}),(0,b.jsx)("div",{className:"space-y-4",children:(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 p-4 bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-950/20 dark:to-cyan-950/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-12 h-12 bg-white dark:bg-gray-800 rounded-lg flex items-center justify-center shadow-sm flex-shrink-0",children:(0,b.jsxs)("svg",{viewBox:"0 0 24 24",className:"w-8 h-8",fill:"none",children:[(0,b.jsx)("path",{d:"M12 2L2 7L12 12L22 7L12 2Z",fill:"#009EE3"}),(0,b.jsx)("path",{d:"M2 17L12 22L22 17M2 12L12 17L22 12",stroke:"#009EE3",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold text-foreground",children:"MercadoPago"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Gesti√≥n de pagos conectada"})]})]}),(0,b.jsx)(B.Button,{variant:"outline",size:"sm",className:"w-full sm:w-auto border-primary text-primary hover:bg-primary hover:text-primary-foreground",onClick:()=>e(!0),children:"Configurar"})]})})]}),(0,b.jsxs)(k.Card,{className:"p-6 border border-border bg-card",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,b.jsx)(g.FileText,{className:"w-5 h-5 text-primary"}),(0,b.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:"Historial de Facturas"})]}),0===i.length?(0,b.jsxs)("div",{className:"text-center py-12 space-y-3",children:[(0,b.jsx)("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mx-auto",children:(0,b.jsx)(g.FileText,{className:"w-8 h-8 text-muted-foreground"})}),(0,b.jsx)("p",{className:"text-muted-foreground font-medium",children:"No hay facturas disponibles"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Tus facturas aparecer√°n aqu√≠ cuando realices pagos"})]}):(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full text-sm",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"border-b border-border",children:[(0,b.jsx)("th",{className:"text-left py-3 text-muted-foreground font-medium",children:"Factura"}),(0,b.jsx)("th",{className:"text-left py-3 text-muted-foreground font-medium",children:"Fecha"}),(0,b.jsx)("th",{className:"text-left py-3 text-muted-foreground font-medium",children:"Monto"}),(0,b.jsx)("th",{className:"text-left py-3 text-muted-foreground font-medium",children:"Estado"}),(0,b.jsx)("th",{className:"text-left py-3 text-muted-foreground font-medium"})]})}),(0,b.jsx)("tbody",{children:i.map(a=>{var c;let d,e=(c=a.status,(d={paid:{bg:"bg-green-100 dark:bg-green-900/30",text:"text-green-800 dark:text-green-400",label:"Pagado",icon:N.CheckCircle2},pending:{bg:"bg-yellow-100 dark:bg-yellow-900/30",text:"text-yellow-800 dark:text-yellow-400",label:"Pendiente",icon:O},failed:{bg:"bg-red-100 dark:bg-red-900/30",text:"text-red-800 dark:text-red-400",label:"Fallido",icon:P.XCircle}})[c]||d.pending),f=e.icon;return(0,b.jsxs)("tr",{className:"border-b border-border hover:bg-muted/50 transition-colors",children:[(0,b.jsx)("td",{className:"py-4 font-medium text-foreground",children:a.id}),(0,b.jsx)("td",{className:"py-4 text-muted-foreground",children:z(a.invoice_date)}),(0,b.jsxs)("td",{className:"py-4 font-medium text-foreground",children:["$",a.amount.toFixed(2)]}),(0,b.jsx)("td",{className:"py-4",children:(0,b.jsxs)("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-medium ${e.bg} ${e.text}`,children:[(0,b.jsx)(f,{className:"w-3.5 h-3.5"}),e.label]})}),(0,b.jsx)("td",{className:"py-4",children:(0,b.jsx)("button",{className:"text-primary hover:text-primary/80 transition-colors",children:(0,b.jsx)(M,{className:"w-4 h-4"})})})]},a.id)})})]})})]}),(0,b.jsx)(J.Dialog,{open:d,onOpenChange:e,children:(0,b.jsxs)(J.DialogContent,{children:[(0,b.jsxs)(J.DialogHeader,{children:[(0,b.jsx)(J.DialogTitle,{children:"Configurar M√©todo de Pago"}),(0,b.jsx)(J.DialogDescription,{children:"Conecta tu cuenta de MercadoPago para gestionar tus pagos de forma segura"})]}),(0,b.jsxs)("div",{className:"space-y-6 py-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-950/20 dark:to-cyan-950/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[(0,b.jsx)("div",{className:"w-16 h-16 bg-white dark:bg-gray-800 rounded-lg flex items-center justify-center shadow-sm",children:(0,b.jsxs)("svg",{viewBox:"0 0 24 24",className:"w-12 h-12",fill:"none",children:[(0,b.jsx)("path",{d:"M12 2L2 7L12 12L22 7L12 2Z",fill:"#009EE3"}),(0,b.jsx)("path",{d:"M2 17L12 22L22 17M2 12L12 17L22 12",stroke:"#009EE3",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h4",{className:"font-semibold text-foreground mb-1",children:"MercadoPago"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Procesamiento seguro de pagos con MercadoPago"})]})]}),(0,b.jsxs)("div",{className:"space-y-3 text-sm text-muted-foreground",children:[(0,b.jsxs)("p",{className:"flex items-start gap-2",children:[(0,b.jsx)(N.CheckCircle2,{className:"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0"}),(0,b.jsx)("span",{children:"Pagos seguros y encriptados"})]}),(0,b.jsxs)("p",{className:"flex items-start gap-2",children:[(0,b.jsx)(N.CheckCircle2,{className:"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0"}),(0,b.jsx)("span",{children:"M√∫ltiples m√©todos de pago disponibles"})]}),(0,b.jsxs)("p",{className:"flex items-start gap-2",children:[(0,b.jsx)(N.CheckCircle2,{className:"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0"}),(0,b.jsx)("span",{children:"Gesti√≥n autom√°tica de suscripciones"})]})]})]}),(0,b.jsxs)(J.DialogFooter,{children:[(0,b.jsx)(B.Button,{variant:"outline",onClick:()=>e(!1),children:"Cancelar"}),(0,b.jsx)(B.Button,{onClick:()=>{r({title:"MercadoPago",description:"Funcionalidad de integraci√≥n pr√≥ximamente disponible"}),e(!1)},className:"bg-[#009EE3] hover:bg-[#0082BD]",children:"Conectar con MercadoPago"})]})]})}),(0,b.jsx)(J.Dialog,{open:f,onOpenChange:h,children:(0,b.jsxs)(J.DialogContent,{className:"max-w-lg",children:[(0,b.jsxs)(J.DialogHeader,{children:[(0,b.jsx)(J.DialogTitle,{children:"Editar Informaci√≥n del Cliente"}),(0,b.jsx)(J.DialogDescription,{children:"Actualiza tu informaci√≥n de contacto"})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"firstName",className:"flex items-center gap-2",children:"Nombre"}),(0,b.jsx)(C.Input,{id:"firstName",value:s.firstName,onChange:a=>t({...s,firstName:a.target.value}),placeholder:"Juan"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"lastName",className:"flex items-center gap-2",children:"Apellido"}),(0,b.jsx)(C.Input,{id:"lastName",value:s.lastName,onChange:a=>t({...s,lastName:a.target.value}),placeholder:"P√©rez"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"email",className:"flex items-center gap-2",children:"Correo electr√≥nico"}),(0,b.jsx)(C.Input,{id:"email",type:"email",value:s.email,onChange:a=>{let b=a.target.value;(t({...s,email:b}),b&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(b))?y("Formato de correo inv√°lido"):y("")},placeholder:"cliente@ejemplo.com",className:x?"border-red-500":""}),x&&(0,b.jsx)("p",{className:"text-xs text-red-500 mt-1",children:x})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"whatsapp",className:"flex items-center gap-2",children:"WhatsApp"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(T.Select,{value:s.countryCode,onValueChange:a=>{t({...s,countryCode:a,phoneNumber:""})},children:[(0,b.jsx)(T.SelectTrigger,{className:"w-[140px]",children:(0,b.jsx)(T.SelectValue,{children:(a=U.find(a=>a.code===s.countryCode))?(0,b.jsxs)("span",{className:"flex items-center gap-1.5",children:[(0,b.jsx)("span",{className:"text-base",children:a.flag}),(0,b.jsx)("span",{className:"text-sm",children:a.code})]}):"Seleccionar"})}),(0,b.jsx)(T.SelectContent,{className:"max-h-[300px]",children:U.map(a=>(0,b.jsx)(T.SelectItem,{value:a.code,children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-base",children:a.flag}),(0,b.jsx)("span",{className:"text-sm",children:a.code}),(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:["(",a.country,")"]})]})},a.code))})]}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)(C.Input,{id:"whatsapp",type:"tel",value:s.phoneNumber,onChange:a=>{let b=a.target.value.replace(/[^\d]/g,""),c=A();b.length<=c&&t({...s,phoneNumber:b})},placeholder:`${"9".repeat(A())}`,maxLength:A(),className:E()?"border-red-500":""}),E()&&(0,b.jsx)("p",{className:"text-xs text-red-500 mt-1",children:E()})]})]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Formato: ",s.countryCode,s.phoneNumber||`${"9".repeat(A())}`]})]})]}),(0,b.jsxs)(J.DialogFooter,{children:[(0,b.jsx)(B.Button,{variant:"outline",onClick:()=>h(!1),children:"Cancelar"}),(0,b.jsx)(B.Button,{onClick:F,children:"Guardar cambios"})]})]})})]})}var W=a.i(97075);let X=(0,d.default)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Y=(0,d.default)("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);var Z=a.i(66843);function $(){let[a,d]=(0,c.useState)(!1),[e,f]=(0,c.useState)(null),{credentials:g,loading:h}=function(){let[a,b]=(0,c.useState)(null),[d,e]=(0,c.useState)(!0),[f,g]=(0,c.useState)(null),{user:h}=v();return(0,c.useEffect)(()=>{if(!h){b(null),e(!1);return}(async()=>{try{let a=(0,u.createClient)(),{data:c,error:d}=await a.from("credentials").select("*").eq("user_id",h.id).single();if(d&&"PGRST116"!==d.code)throw d;b(c||null)}catch(a){g(a instanceof Error?a.message:"Error fetching credentials")}finally{e(!1)}})()},[h]),{credentials:a,loading:d,error:f}}(),i=(a,b)=>{navigator.clipboard.writeText(a),f(b),setTimeout(()=>f(null),2e3)};return h?(0,b.jsx)("div",{className:"text-center py-8",children:"Cargando credenciales..."}):g?(0,b.jsxs)("div",{className:"space-y-8",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-3xl font-bold text-foreground mb-2",children:"Credenciales de Acceso"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Usa estas credenciales para acceder a MaxPlayer IPTV"})]}),(0,b.jsx)(k.Card,{className:"p-4 border-orange-300 bg-orange-50 dark:bg-orange-900/20",children:(0,b.jsx)("p",{className:"text-sm text-orange-900 dark:text-orange-300",children:"Mant√©n tus credenciales confidenciales. No las compartas con terceros."})}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)(k.Card,{className:"p-6 border border-border bg-card",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Usuario"}),(0,b.jsx)("button",{onClick:()=>i(g.username,"username"),className:"text-accent hover:text-accent/80 transition-colors",children:(0,b.jsx)(W.Copy,{className:"w-4 h-4"})})]}),(0,b.jsx)("p",{className:"font-mono text-lg font-semibold text-foreground break-all",children:g.username}),"username"===e&&(0,b.jsx)("p",{className:"text-xs text-green-600 mt-2",children:"Copiado"})]}),(0,b.jsxs)(k.Card,{className:"p-6 border border-border bg-card",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Contrase√±a"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("button",{onClick:()=>d(!a),className:"text-muted-foreground hover:text-foreground transition-colors",children:a?(0,b.jsx)(Y,{className:"w-4 h-4"}):(0,b.jsx)(X,{className:"w-4 h-4"})}),(0,b.jsx)("button",{onClick:()=>i(g.password,"password"),className:"text-accent hover:text-accent/80 transition-colors",children:(0,b.jsx)(W.Copy,{className:"w-4 h-4"})})]})]}),(0,b.jsx)("p",{className:"font-mono text-lg font-semibold text-foreground break-all",children:a?g.password:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"}),"password"===e&&(0,b.jsx)("p",{className:"text-xs text-green-600 mt-2",children:"Copiado"})]}),(0,b.jsxs)(k.Card,{className:"p-6 border border-border bg-card",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Direcci√≥n MAC"}),(0,b.jsx)("button",{onClick:()=>i(g.mac_address,"mac"),className:"text-accent hover:text-accent/80 transition-colors",children:(0,b.jsx)(W.Copy,{className:"w-4 h-4"})})]}),(0,b.jsx)("p",{className:"font-mono text-lg font-semibold text-foreground break-all",children:g.mac_address}),"mac"===e&&(0,b.jsx)("p",{className:"text-xs text-green-600 mt-2",children:"Copiado"})]}),(0,b.jsxs)(k.Card,{className:"p-6 border border-border bg-card",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"C√≥digo Revendedor"}),(0,b.jsx)("button",{onClick:()=>i(g.reseller_code,"reseller"),className:"text-accent hover:text-accent/80 transition-colors",children:(0,b.jsx)(W.Copy,{className:"w-4 h-4"})})]}),(0,b.jsx)("p",{className:"font-mono text-lg font-semibold text-foreground break-all",children:g.reseller_code}),"reseller"===e&&(0,b.jsx)("p",{className:"text-xs text-green-600 mt-2",children:"Copiado"})]})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:"Opciones de Seguridad"}),(0,b.jsxs)(B.Button,{variant:"outline",className:"w-full flex items-center gap-2 bg-transparent",children:[(0,b.jsx)(Z.RefreshCw,{className:"w-4 h-4"}),"Cambiar contrase√±a"]}),(0,b.jsx)(B.Button,{variant:"outline",className:"w-full bg-transparent",children:"Historial de conexiones"})]})]}):(0,b.jsx)("div",{className:"text-center py-8",children:"No hay credenciales disponibles"})}let _={email_notifications:!0,whatsapp_notifications:!0,renewal_reminder:!0,plan_changes_notifications:!0};var aa=a.i(95610),ab=a.i(86952),ac=a.i(74288);function ad({profile:a,updateProfile:d}){let{toast:e}=(0,I.useToast)(),[f,g]=(0,c.useState)(!1),[h,i]=(0,c.useState)({firstName:"",lastName:"",email:"",countryCode:"+51",phoneNumber:""}),[j,l]=(0,c.useState)("");(0,c.useEffect)(()=>{if(f){let b=(()=>{if(!a)return null;let b="+51",c="";if(a.whatsapp){let d=a.whatsapp.trim(),e=U.find(a=>d.startsWith(a.code));e?(b=e.code,c=d.substring(e.code.length).replace(/\D/g,"")):c=d.replace(/\D/g,"")}return{firstName:a.first_name||"",lastName:a.last_name||"",email:a.email||"",countryCode:b,phoneNumber:c}})();b&&i(b)}},[f,a]);let m=async()=>{var a;let b;if(!h.email||(a=h.email,!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a))){l("Por favor ingresa un correo electr√≥nico v√°lido"),e({variant:"destructive",title:"Error de validaci√≥n",description:"El correo electr√≥nico no tiene un formato v√°lido",duration:3e3});return}l("");let c=(b=U.find(a=>a.code===h.countryCode))&&h.phoneNumber&&h.phoneNumber.length!==b.maxDigits?`Para ${b.country} se requieren exactamente ${b.maxDigits} d\xedgitos`:"";if(h.phoneNumber&&c)return void e({variant:"destructive",title:"Error de validaci√≥n",description:c,duration:3e3});let f=h.phoneNumber?`${h.countryCode}${h.phoneNumber.replace(/\s/g,"")}`:"",{error:i}=await d({first_name:h.firstName,last_name:h.lastName,email:h.email,whatsapp:f});i?e({variant:"destructive",title:"Error",description:"No se pudo actualizar la informaci√≥n: "+i,duration:3e3}):(e({variant:"success",title:"‚úì Informaci√≥n actualizada",description:"Tu informaci√≥n de contacto se ha guardado correctamente",duration:3e3}),g(!1))};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(k.Card,{children:[(0,b.jsxs)(k.CardHeader,{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(aa.User,{className:"w-5 h-5 text-primary"}),(0,b.jsx)(k.CardTitle,{children:"Cuenta y Seguridad"})]}),(0,b.jsx)(B.Button,{variant:"outline",size:"sm",className:"border-primary text-primary hover:bg-primary hover:text-primary-foreground",onClick:()=>g(!0),children:"Editar informaci√≥n"})]}),(0,b.jsx)(k.CardDescription,{children:"Tu informaci√≥n personal y opciones de seguridad"})]}),(0,b.jsx)(k.CardContent,{className:"space-y-6",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("h3",{className:"text-sm font-semibold text-foreground flex items-center gap-2",children:[(0,b.jsx)(aa.User,{className:"w-4 h-4 text-primary"}),"Informaci√≥n Personal"]}),(0,b.jsxs)("div",{className:"grid gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4 p-4 bg-gradient-to-r from-primary/5 to-transparent rounded-lg border border-primary/10",children:[(0,b.jsx)("div",{className:"w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center flex-shrink-0",children:(0,b.jsx)(aa.User,{className:"w-5 h-5 text-primary"})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:"Nombre completo"}),(0,b.jsx)("p",{className:"text-base font-medium text-foreground",children:a?.first_name||a?.last_name?`${a.first_name||""} ${a.last_name||""}`.trim():"No especificado"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4 p-4 bg-gradient-to-r from-primary/5 to-transparent rounded-lg border border-primary/10",children:[(0,b.jsx)("div",{className:"w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center flex-shrink-0",children:(0,b.jsx)(ab.Mail,{className:"w-5 h-5 text-primary"})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:"Correo electr√≥nico"}),(0,b.jsx)("p",{className:"text-base font-medium text-foreground truncate",children:a?.email||"No especificado"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4 p-4 bg-gradient-to-r from-primary/5 to-transparent rounded-lg border border-primary/10",children:[(0,b.jsx)("div",{className:"w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center flex-shrink-0",children:(0,b.jsx)(ac.Phone,{className:"w-5 h-5 text-primary"})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:"WhatsApp"}),(0,b.jsx)("p",{className:"text-base font-medium text-foreground",children:a?.whatsapp||"No especificado"})]})]})]})]})})]}),(0,b.jsx)(J.Dialog,{open:f,onOpenChange:g,children:(0,b.jsxs)(J.DialogContent,{className:"sm:max-w-[500px]",children:[(0,b.jsxs)(J.DialogHeader,{children:[(0,b.jsx)(J.DialogTitle,{children:"Editar Informaci√≥n Personal"}),(0,b.jsx)(J.DialogDescription,{children:"Actualiza tus datos de contacto aqu√≠."})]}),(0,b.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"firstName",children:"Nombre"}),(0,b.jsx)(C.Input,{id:"firstName",value:h.firstName,onChange:a=>i({...h,firstName:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"lastName",children:"Apellido"}),(0,b.jsx)(C.Input,{id:"lastName",value:h.lastName,onChange:a=>i({...h,lastName:a.target.value})})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"email",children:"Correo Electr√≥nico"}),(0,b.jsx)(C.Input,{id:"email",type:"email",value:h.email,onChange:a=>{i({...h,email:a.target.value}),l("")},className:j?"border-red-500":""}),j&&(0,b.jsx)("p",{className:"text-xs text-red-500",children:j})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"whatsapp",children:"WhatsApp"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(T.Select,{value:h.countryCode,onValueChange:a=>i({...h,countryCode:a}),children:[(0,b.jsx)(T.SelectTrigger,{className:"w-[140px]",children:(0,b.jsx)(T.SelectValue,{placeholder:"Pa√≠s"})}),(0,b.jsx)(T.SelectContent,{className:"max-h-[300px]",children:U.map(a=>(0,b.jsxs)(T.SelectItem,{value:a.code,children:[(0,b.jsx)("span",{className:"mr-2",children:a.flag}),a.code]},a.code))})]}),(0,b.jsx)(C.Input,{id:"whatsapp",type:"tel",placeholder:"N√∫mero",value:h.phoneNumber,onChange:a=>{let b,c=a.target.value.replace(/\D/g,""),d=(b=U.find(a=>a.code===h.countryCode),b?.maxDigits||15);c.length<=d&&i({...h,phoneNumber:c})},className:"flex-1"})]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:h.countryCode&&U.find(a=>a.code===h.countryCode)?.country})]})]}),(0,b.jsxs)(J.DialogFooter,{children:[(0,b.jsx)(B.Button,{variant:"outline",onClick:()=>g(!1),children:"Cancelar"}),(0,b.jsx)(B.Button,{onClick:m,children:"Guardar Cambios"})]})]})})]})}var ae=a.i(43977),af=a.i(19259);function ag({settings:a,updateSettings:d}){let{toast:e}=(0,I.useToast)(),[f,g]=(0,c.useState)({email:!0,whatsapp:!0,renewalReminder:!0,planChanges:!0}),[h,i]=(0,c.useState)(!1);(0,c.useEffect)(()=>{a&&g({email:a.email_notifications??!0,whatsapp:a.whatsapp_notifications??!0,renewalReminder:a.renewal_reminder??!0,planChanges:a.plan_changes_notifications??!0})},[a]);let j=async()=>{i(!0);try{(await d({email_notifications:f.email,whatsapp_notifications:f.whatsapp,renewal_reminder:f.renewalReminder,plan_changes_notifications:f.planChanges})).success?e({variant:"success",title:"Configuraci√≥n guardada",description:"Tus preferencias han sido actualizadas correctamente.",duration:3e3}):e({title:"Error al guardar",description:"No se pudo guardar la configuraci√≥n.",variant:"destructive",duration:3e3})}catch(a){e({title:"Error al guardar",description:"Ocurri√≥ un error al guardar.",variant:"destructive",duration:3e3})}finally{i(!1)}};return(0,b.jsxs)(k.Card,{children:[(0,b.jsxs)(k.CardHeader,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(af.Bell,{className:"w-5 h-5 text-primary"}),(0,b.jsx)(k.CardTitle,{children:"Notificaciones"})]}),(0,b.jsx)(k.CardDescription,{children:"Configura c√≥mo y cu√°ndo quieres recibir notificaciones"})]}),(0,b.jsxs)(k.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"space-y-0.5",children:[(0,b.jsx)(D.Label,{htmlFor:"email-notifications",children:"Notificaciones por Email"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Recibe actualizaciones por correo electr√≥nico"})]}),(0,b.jsx)(ae.Switch,{id:"email-notifications",checked:f.email,onCheckedChange:a=>g({...f,email:a})})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"space-y-0.5",children:[(0,b.jsx)(D.Label,{htmlFor:"whatsapp-notifications",children:"Notificaciones por WhatsApp"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Recibe alertas por WhatsApp"})]}),(0,b.jsx)(ae.Switch,{id:"whatsapp-notifications",checked:f.whatsapp,onCheckedChange:a=>g({...f,whatsapp:a})})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"space-y-0.5",children:[(0,b.jsx)(D.Label,{htmlFor:"renewal-reminder",children:"Recordatorio de Renovaci√≥n"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Te avisamos antes de que venza tu suscripci√≥n"})]}),(0,b.jsx)(ae.Switch,{id:"renewal-reminder",checked:f.renewalReminder,onCheckedChange:a=>g({...f,renewalReminder:a})})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"space-y-0.5",children:[(0,b.jsx)(D.Label,{htmlFor:"plan-changes",children:"Cambios de Plan"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Notificaciones sobre actualizaciones de tu plan"})]}),(0,b.jsx)(ae.Switch,{id:"plan-changes",checked:f.planChanges,onCheckedChange:a=>g({...f,planChanges:a})})]}),(0,b.jsx)(B.Button,{onClick:j,className:"w-full mt-4",disabled:h,children:h?"Guardando...":"Guardar Preferencias"})]})]})}var ah=a.i(26999),ai=a.i(72604),aj=a.i(22863),ak=a.i(26636),al=(0,ak.createServerReference)("40df9a50f8f7f384b9cf18a7f7a884249bbe6d64f0",ak.callServer,void 0,ak.findSourceMapURL,"deleteUserAccount");function am({user:a}){let{toast:d}=(0,I.useToast)(),e=(0,u.createClient)(),[f,g]=(0,c.useState)(!1),[h,i]=(0,c.useState)(!1),[j,l]=(0,c.useState)(""),[m,n]=(0,c.useState)({current:"",new:"",confirm:""}),[o,p]=(0,c.useState)({new:"",confirm:"",general:""}),[q,r]=(0,c.useState)(!1),s=async()=>{if(p({new:"",confirm:"",general:""}),!m.new||!m.confirm){p({new:m.new?"":"Este campo es requerido",confirm:m.confirm?"":"Este campo es requerido",general:""}),d({title:"Error",description:"Por favor completa todos los campos.",variant:"destructive",duration:3e3});return}if(m.new.length<8){p({new:"La contrase√±a debe tener al menos 8 caracteres",confirm:"",general:""}),d({title:"Error",description:"La contrase√±a debe tener al menos 8 caracteres.",variant:"destructive",duration:3e3});return}if(m.new!==m.confirm){p({new:"",confirm:"Las contrase√±as no coinciden",general:""}),d({title:"Error",description:"Las contrase√±as nuevas no coinciden.",variant:"destructive",duration:3e3});return}r(!0);try{let{error:a}=await e.auth.updateUser({password:m.new});a?d({title:"Error al cambiar contrase√±a",description:a.message,variant:"destructive",duration:3e3}):(d({variant:"success",title:"Contrase√±a actualizada",description:"Tu contrase√±a ha sido cambiada exitosamente.",duration:3e3}),i(!1),n({current:"",new:"",confirm:""}),p({new:"",confirm:"",general:""}))}catch(a){d({title:"Error al cambiar contrase√±a",description:"Ocurri√≥ un error al cambiar la contrase√±a.",variant:"destructive",duration:3e3})}finally{r(!1)}},t=async()=>{if("ELIMINAR"!==j)return void d({title:"Error",description:"Por favor escribe ELIMINAR para confirmar.",variant:"destructive",duration:3e3});if(!a?.id)return void d({title:"Error",description:"No se pudo identificar el usuario.",variant:"destructive",duration:3e3});try{let b=await al(a.id);if(!b.success)return void d({title:"Error",description:b.error||"No se pudo eliminar la cuenta. Contacta con soporte.",variant:"destructive",duration:3e3});await e.auth.signOut(),window.location.href="/auth/login"}catch(a){console.error("Error deleting account:",a),d({title:"Error",description:"Ocurri√≥ un error inesperado. Contacta con soporte.",variant:"destructive",duration:3e3})}};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(k.Card,{children:[(0,b.jsxs)(k.CardHeader,{children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(ah.Shield,{className:"w-5 h-5 text-primary"}),(0,b.jsx)(k.CardTitle,{children:"Seguridad"})]})}),(0,b.jsx)(k.CardDescription,{children:"Opciones de seguridad de tu cuenta"})]}),(0,b.jsx)(k.CardContent,{className:"space-y-6",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("h3",{className:"text-sm font-semibold text-foreground flex items-center gap-2",children:[(0,b.jsx)(ah.Shield,{className:"w-4 h-4 text-primary"}),"Contrase√±a"]}),(0,b.jsxs)("button",{onClick:()=>i(!0),className:"w-full flex items-center justify-between p-4 bg-gradient-to-r from-primary/5 to-transparent rounded-lg border border-primary/10 hover:border-primary/30 transition-all group",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:"w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center flex-shrink-0 group-hover:bg-primary/20 transition-colors",children:(0,b.jsx)(ai.Lock,{className:"w-5 h-5 text-primary"})}),(0,b.jsxs)("div",{className:"text-left",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-foreground",children:"Cambiar Contrase√±a"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Actualiza tu contrase√±a de acceso"})]})]}),(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-muted-foreground group-hover:text-primary transition-colors",children:(0,b.jsx)("path",{d:"m9 18 6-6-6-6"})})]})]})})]}),(0,b.jsxs)(k.Card,{className:"border-destructive/50 mt-6",children:[(0,b.jsxs)(k.CardHeader,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(aj.Trash2,{className:"w-5 h-5 text-destructive"}),(0,b.jsx)(k.CardTitle,{className:"text-destructive",children:"Zona Peligrosa"})]}),(0,b.jsx)(k.CardDescription,{children:"Acciones irreversibles en tu cuenta"})]}),(0,b.jsx)(k.CardContent,{className:"space-y-4",children:(0,b.jsxs)(B.Button,{onClick:()=>g(!0),variant:"destructive",className:"w-full",children:[(0,b.jsx)(aj.Trash2,{className:"w-4 h-4 mr-2"}),"Eliminar Cuenta"]})})]}),(0,b.jsx)(J.Dialog,{open:h,onOpenChange:i,children:(0,b.jsxs)(J.DialogContent,{children:[(0,b.jsxs)(J.DialogHeader,{children:[(0,b.jsx)(J.DialogTitle,{children:"Cambiar Contrase√±a"}),(0,b.jsx)(J.DialogDescription,{children:"Ingresa tu nueva contrase√±a (m√≠nimo 8 caracteres)"})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"new-password",children:"Nueva Contrase√±a"}),(0,b.jsx)(C.Input,{id:"new-password",type:"password",value:m.new,onChange:a=>n({...m,new:a.target.value}),className:o.new?"border-destructive":""}),o.new&&(0,b.jsx)("p",{className:"text-sm text-destructive",children:o.new}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"M√≠nimo 8 caracteres"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"confirm-password",children:"Confirmar Nueva Contrase√±a"}),(0,b.jsx)(C.Input,{id:"confirm-password",type:"password",value:m.confirm,onChange:a=>n({...m,confirm:a.target.value}),className:o.confirm?"border-destructive":""}),o.confirm&&(0,b.jsx)("p",{className:"text-sm text-destructive",children:o.confirm})]})]}),(0,b.jsxs)(J.DialogFooter,{children:[(0,b.jsx)(B.Button,{variant:"outline",onClick:()=>i(!1),children:"Cancelar"}),(0,b.jsx)(B.Button,{onClick:s,disabled:q,children:q?"Actualizando...":"Actualizar Contrase√±a"})]})]})}),(0,b.jsx)(J.Dialog,{open:f,onOpenChange:g,children:(0,b.jsxs)(J.DialogContent,{children:[(0,b.jsxs)(J.DialogHeader,{children:[(0,b.jsx)(J.DialogTitle,{className:"text-destructive",children:"Eliminar Cuenta"}),(0,b.jsx)(J.DialogDescription,{children:"Esta acci√≥n es irreversible. Todos tus datos ser√°n eliminados permanentemente."})]}),(0,b.jsxs)("div",{className:"py-4",children:[(0,b.jsxs)("p",{className:"text-sm text-muted-foreground mb-4",children:["Para confirmar, escribe ",(0,b.jsx)("strong",{children:"ELIMINAR"})," en el campo de abajo:"]}),(0,b.jsx)(C.Input,{placeholder:"ELIMINAR",value:j,onChange:a=>l(a.target.value)})]}),(0,b.jsxs)(J.DialogFooter,{children:[(0,b.jsx)(B.Button,{variant:"outline",onClick:()=>g(!1),children:"Cancelar"}),(0,b.jsx)(B.Button,{variant:"destructive",onClick:t,disabled:"ELIMINAR"!==j,children:"Eliminar Cuenta"})]})]})})]})}function an({subscription:a}){let{toast:d}=(0,I.useToast)(),[e,f]=(0,c.useState)(!1),[g,h]=(0,c.useState)(!1),i=async()=>{h(!0);try{await new Promise(a=>setTimeout(a,1500)),d({variant:"success",title:"Dispositivos reseteados",description:"Todos los dispositivos han sido desconectados exitosamente.",duration:3e3}),f(!1)}catch(a){d({title:"Error",description:"No se pudieron resetear los dispositivos.",variant:"destructive",duration:3e3})}finally{h(!1)}};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(k.Card,{id:"devices-section",children:[(0,b.jsxs)(k.CardHeader,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(s,{className:"w-5 h-5 text-primary"}),(0,b.jsx)(k.CardTitle,{children:"Gesti√≥n de Dispositivos"})]}),(0,b.jsx)(k.CardDescription,{children:"Administra los dispositivos conectados a tu cuenta"})]}),(0,b.jsxs)(k.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-primary/5 to-transparent rounded-lg border border-primary/10",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center flex-shrink-0",children:(0,b.jsx)(s,{className:"w-6 h-6 text-primary"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-base font-medium text-foreground",children:"Dispositivos conectados"}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["2 de ",a?.plan?.max_screens||1," dispositivos activos"]})]})]}),(0,b.jsx)(B.Button,{variant:"outline",size:"sm",className:"border-destructive text-destructive hover:bg-destructive hover:text-destructive-foreground",onClick:()=>f(!0),children:"Resetear Dispositivos"})]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Al resetear los dispositivos, se desconectar√°n todos los dispositivos actualmente conectados. Deber√°s volver a iniciar sesi√≥n en cada uno de ellos."})]})]}),(0,b.jsx)(J.Dialog,{open:e,onOpenChange:f,children:(0,b.jsxs)(J.DialogContent,{children:[(0,b.jsxs)(J.DialogHeader,{children:[(0,b.jsx)(J.DialogTitle,{children:"Resetear Dispositivos"}),(0,b.jsx)(J.DialogDescription,{children:"¬øEst√°s seguro de que deseas desconectar todos los dispositivos?"})]}),(0,b.jsxs)(J.DialogFooter,{children:[(0,b.jsx)(B.Button,{variant:"outline",onClick:()=>f(!1),children:"Cancelar"}),(0,b.jsx)(B.Button,{variant:"destructive",onClick:i,disabled:g,children:g?"Reseteando...":"S√≠, Resetear Todo"})]})]})})]})}function ao(){let{settings:a,loading:d,updateSettings:e}=function(){let a=(0,u.createClient)(),{user:b}=v(),[d,e]=(0,c.useState)(_),[f,g]=(0,c.useState)(!0),[h,i]=(0,c.useState)(null);(0,c.useEffect)(()=>{b&&j()},[b]);let j=async()=>{try{g(!0),console.log("[v0] Cargando settings para usuario:",b?.id);let{data:c,error:d}=await a.from("user_settings").select("*").eq("user_id",b?.id).single();if(d){console.log("[v0] Settings table not found, using defaults:",d.message),e(_),i(null);return}console.log("[v0] Settings cargados:",c),e(c)}catch(a){console.log("[v0] Error fetching settings, using defaults:",a),e(_),i(null)}finally{g(!1)}};return{settings:d,loading:f,error:h,updateSettings:async c=>{try{let{data:d}=await a.from("user_settings").select("id").eq("user_id",b?.id).single();if(d){let{error:d}=await a.from("user_settings").update({...c,updated_at:new Date().toISOString()}).eq("user_id",b?.id);if(d)return console.log("[v0] Cannot save to DB, updating locally only:",d),e(a=>({...a,...c})),{success:!0,local:!0}}else{let{error:d}=await a.from("user_settings").insert({user_id:b?.id,..._,...c});if(d)return console.log("[v0] Cannot create settings in DB, updating locally only:",d),e(a=>({...a,...c})),{success:!0,local:!0}}return e(a=>({...a,...c})),{success:!0}}catch(a){return console.error("[v0] Error updating settings:",a),e(a=>({...a,...c})),{success:!0,local:!0}}},refetch:j}}(),{profile:f,loading:g,updateProfile:h}=S(),{subscription:i}=w(),{user:j}=v();return d||g?(0,b.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Cargando configuraci√≥n..."})]})}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-foreground",children:"Configuraci√≥n"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1",children:"Administra las preferencias de tu cuenta"})]}),(0,b.jsx)(ad,{profile:f,updateProfile:h}),(0,b.jsx)(ag,{settings:a,updateSettings:e}),(0,b.jsx)(an,{subscription:i}),(0,b.jsx)(am,{user:j})]})}var ap=a.i(81010);function aq(){let[a,d]=(0,c.useState)("home"),[e,f]=(0,c.useState)(!1),[g,h]=(0,c.useState)(!0),i=(0,ap.useRouter)();(0,c.useEffect)(()=>{k()},[]);let k=async()=>{let a=(0,u.createBrowserClient)(),{data:{user:b}}=await a.auth.getUser();if(b){let{data:c}=await a.from("profiles").select("role").eq("id",b.id).single();f(c?.role==="admin")}h(!1)};return(0,b.jsxs)(j,{currentView:a,setCurrentView:d,children:[!g&&e&&(0,b.jsx)("div",{className:"mb-4",children:(0,b.jsxs)(B.Button,{onClick:()=>i.push("/admin"),className:"w-full gap-2 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700",children:[(0,b.jsx)(ah.Shield,{className:"h-4 w-4"}),"Acceder al Panel de Administraci√≥n"]})}),(0,b.jsxs)("div",{className:"min-h-[600px]",children:[(0,b.jsx)("div",{style:{display:"home"===a?"block":"none"},children:(0,b.jsx)(A,{setCurrentView:d})}),(0,b.jsx)("div",{style:{display:"plans"===a?"block":"none"},children:(0,b.jsx)(L,{setCurrentView:d})}),(0,b.jsx)("div",{style:{display:"billing"===a?"block":"none"},children:(0,b.jsx)(V,{})}),(0,b.jsx)("div",{style:{display:"credentials"===a?"block":"none"},children:(0,b.jsx)($,{})}),(0,b.jsx)("div",{style:{display:"settings"===a?"block":"none"},children:(0,b.jsx)(ao,{})})]})]})}a.s(["default",()=>aq],18683)}];

//# sourceMappingURL=iptv_components_42cc0064._.js.map