{"version":3,"sources":["turbopack:///[project]/iptv/node_modules/.pnpm/next@16.0.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts","turbopack:///[project]/iptv/node_modules/.pnpm/next@16.0.0_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts","turbopack:///[project]/iptv/app/actions/auth-actions.ts","turbopack:///[project]/iptv/.next-internal/server/app/auth/sign-up/page/actions.js (server actions loader)"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n","// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n","'use server'\r\n\r\nimport { createClient } from '@supabase/supabase-js'\r\n\r\nexport async function registerUser(data: any) {\r\n    try {\r\n        const supabase = createClient(\r\n            process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n            process.env.SUPABASE_SERVICE_ROLE_KEY!,\r\n            {\r\n                auth: {\r\n                    autoRefreshToken: false,\r\n                    persistSession: false\r\n                }\r\n            }\r\n        )\r\n\r\n        // 1. Crear usuario en Auth con auto-confirmaciÃ³n\r\n        const { data: authUser, error: authError } = await supabase.auth.admin.createUser({\r\n            email: data.email,\r\n            password: data.password,\r\n            email_confirm: true,\r\n            user_metadata: {\r\n                first_name: data.first_name,\r\n                last_name: data.last_name,\r\n                full_name: `${data.first_name} ${data.last_name}`.trim()\r\n            }\r\n        })\r\n\r\n        if (authError) return { success: false, error: authError.message }\r\n        if (!authUser.user) return { success: false, error: 'No se pudo crear el usuario' }\r\n\r\n        // Force confirm email explicitly\r\n        await supabase.auth.admin.updateUserById(authUser.user.id, { email_confirm: true })\r\n\r\n        // 2. Crear perfil\r\n        const { error: profileError } = await supabase\r\n            .from('profiles')\r\n            .upsert({\r\n                id: authUser.user.id,\r\n                email: data.email,\r\n                first_name: data.first_name,\r\n                last_name: data.last_name,\r\n                whatsapp: data.whatsapp,\r\n                role: 'user'\r\n            })\r\n\r\n        if (profileError) {\r\n            console.error('Error creando perfil:', profileError)\r\n        }\r\n\r\n        return { success: true }\r\n    } catch (error) {\r\n        console.error('Error en registerUser:', error)\r\n        return { success: false, error: 'Error interno del servidor' }\r\n    }\r\n}\r\n\r\n/**\r\n * Deletes a user account and all associated data\r\n * This MUST run on the server with service_role_key for security\r\n */\r\nexport async function deleteUserAccount(userId: string) {\r\n    try {\r\n        const supabase = createClient(\r\n            process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n            process.env.SUPABASE_SERVICE_ROLE_KEY!,\r\n            {\r\n                auth: {\r\n                    autoRefreshToken: false,\r\n                    persistSession: false\r\n                }\r\n            }\r\n        )\r\n\r\n        // Delete user from auth (this will cascade delete related data via DB triggers/policies)\r\n        const { error } = await supabase.auth.admin.deleteUser(userId)\r\n\r\n        if (error) {\r\n            console.error('Error deleting user:', error)\r\n            return { success: false, error: error.message }\r\n        }\r\n\r\n        return { success: true }\r\n    } catch (error) {\r\n        console.error('Error en deleteUserAccount:', error)\r\n        return { success: false, error: 'Error interno del servidor' }\r\n    }\r\n}\r\n","export {registerUser as '40d454dcfeb696f8ad3cc6e3e517927190a0be331a'} from 'ACTIONS_MODULE0'\n"],"names":["registerServerReference","ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"6CAAoD,OAAA,cAAA,CAAA,EAAA,aAAA,oCAC3CA,0BAAAA,qCAAAA,EAAAA,uBAAuB,YAAQ,CAAA,CAAA,IAAA,gCCEjC,SAASC,EAAyBC,CAAc,EACrD,IAAK,IAAIC,EAAI,EAAGA,EAAID,EAAQE,MAAM,CAAED,IAAK,CACvC,IAAME,EAASH,CAAO,CAACC,EAAE,CACzB,GAAsB,YAAlB,AAA8B,OAAvBE,EACT,MAAM,OAAA,cAEL,CAFK,AAAIC,MACR,CAAC,2DAA2D,EAAE,OAAOD,EAAO;AAAA,oEAAuE,CAAC,EADhJ,oBAAA,OAAA,mBAAA,eAAA,EAEN,EAEJ,CACF,0EATgBJ,2BAAAA,qCAAAA,8CCDhB,EAAA,EAAA,CAAA,CAAA,OAEO,eAAe,EAAa,CAAS,EACxC,GAAI,CACA,IAAM,EAAW,CAAA,EAAA,EAAA,YAAA,AAAY,EAAA,2CAEzB,QAAQ,GAAG,CAAC,yBAAyB,CACrC,CACI,KAAM,CACF,iBAAkB,GAClB,eAAgB,EACpB,CACJ,GAIE,CAAE,KAAM,CAAQ,CAAE,MAAO,CAAS,CAAE,CAAG,MAAM,EAAS,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,CAC9E,MAAO,EAAK,KAAK,CACjB,SAAU,EAAK,QAAQ,CACvB,eAAe,EACf,cAAe,CACX,WAAY,EAAK,UAAU,CAC3B,UAAW,EAAK,SAAS,CACzB,UAAW,CAAA,EAAG,EAAK,UAAU,CAAC,CAAC,EAAE,EAAK,SAAS,CAAA,CAAE,CAAC,IAAI,EAC1D,CACJ,GAEA,GAAI,EAAW,MAAO,CAAE,SAAS,EAAO,MAAO,EAAU,OAAQ,AAAD,EAChE,GAAI,CAAC,EAAS,IAAI,CAAE,MAAO,CAAE,SAAS,EAAO,MAAO,6BAA8B,CAGlF,OAAM,EAAS,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,EAAS,IAAI,CAAC,EAAE,CAAE,CAAE,eAAe,CAAK,GAGjF,GAAM,CAAE,MAAO,CAAY,CAAE,CAAG,MAAM,EACjC,IAAI,CAAC,YACL,MAAM,CAAC,CACJ,GAAI,EAAS,IAAI,CAAC,EAAE,CACpB,MAAO,EAAK,KAAK,CACjB,WAAY,EAAK,UAAU,CAC3B,UAAW,EAAK,SAAS,CACzB,SAAU,EAAK,QAAQ,CACvB,KAAM,MACV,GAMJ,OAJI,GACA,QAAQ,GADM,EACD,CAAC,wBAAyB,GAGpC,CAAE,SAAS,CAAK,CAC3B,CAAE,MAAO,EAAO,CAEZ,OADA,QAAQ,KAAK,CAAC,yBAA0B,GACjC,CAAE,SAAS,EAAO,MAAO,4BAA6B,CACjE,CACJ,CAMO,eAAe,EAAkB,CAAc,EAClD,GAAI,CACA,IAAM,EAAW,CAAA,EAAA,EAAA,YAAA,AAAY,EAAA,2CAEzB,QAAQ,GAAG,CAAC,yBAAyB,CACrC,CACI,KAAM,CACF,iBAAkB,GAClB,gBAAgB,CACpB,CACJ,GAIE,OAAE,CAAK,CAAE,CAAG,MAAM,EAAS,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,GAEvD,GAAI,EAEA,KAFO,EACP,QAAQ,KAAK,CAAC,uBAAwB,GAC/B,CAAE,QAAS,GAAO,MAAO,EAAM,OAAO,AAAC,EAGlD,MAAO,CAAE,SAAS,CAAK,CAC3B,CAAE,MAAO,EAAO,CAEZ,OADA,QAAQ,KAAK,CAAC,8BAA+B,GACtC,CAAE,SAAS,EAAO,MAAO,4BAA6B,CACjE,CACJ,0CApFsB,EA0DA,IA1DA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MA0DA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,oFC9DtB,IAAA,EAAA,EAAA,CAAA,CAAA","ignoreList":[0,1]}